{% extends "base.html" %}

{% block title %}SQL Injection Successful{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="alert alert-danger">
        <h2><i class="fa fa-exclamation-triangle"></i> Security Breach</h2>
        <p>{{ message }}</p>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            Executed SQL Query
        </div>
        <div class="card-body">
            <pre><code>{{ query }}</code></pre>
            <p class="text-muted">This query bypassed the authentication system by making the WHERE clause always evaluate to true.</p>
        </div>
    </div>

    <h3>Exposed User Data:</h3>
    
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Password Hash</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.password }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="card mt-4">
        <div class="card-header bg-primary text-white">
            How This Attack Works
        </div>
        <div class="card-body">
            <p>The SQL injection attack used is <code>' OR 1=1 --</code>, which works as follows:</p>
            <ol>
                <li>The single quote (<code>'</code>) closes the username string in the query</li>
                <li>The <code>OR 1=1</code> makes the WHERE clause always true</li>
                <li>The double dash (<code>--</code>) comments out the rest of the query</li>
            </ol>
            <p>This transforms the original query from:</p>
            <pre><code>SELECT * FROM users WHERE username = 'anyusername' AND password = '' OR 1=1 --'</code></pre>
            <p>Into effectively:</p>
            <pre><code>SELECT * FROM users WHERE username = 'anyusername' OR 1=1</code></pre>
            <p>Since <code>1=1</code> is always true, this returns all users!</p>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header bg-success text-white">
            How to Prevent SQL Injection
        </div>
        <div class="card-body">
            <h5>Use Parameterized Queries</h5>
            <pre><code>cursor.execute('SELECT * FROM users WHERE username = ? AND password = ?', (username, password))</code></pre>
            
            <h5>Use an ORM (Object-Relational Mapping) Library</h5>
            <p>ORMs like SQLAlchemy handle parameter escaping automatically.</p>
            
            <h5>Input Validation</h5>
            <p>Validate and sanitize all user inputs before using them in SQL queries.</p>
        </div>
    </div>

    <div class="mt-4">
        <a href="{{ url_for('logout') }}" class="btn btn-primary">Logout</a>
    </div>
</div>
{% endblock %} 