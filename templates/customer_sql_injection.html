{% extends "base.html" %}

{% block title %}SQL Injection Successful{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="alert alert-danger">
        <h2><i class="fa fa-exclamation-triangle"></i> Security Breach</h2>
        <p>{{ message }}</p>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            Executed SQL Query
        </div>
        <div class="card-body">
            <pre><code>{{ query }}</code></pre>
            <p class="text-muted">This query was vulnerable to SQL injection, allowing access to all customer data.</p>
        </div>
    </div>

    <h3>Exposed Customer Data:</h3>
    
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Customer Name</th>
                <th>User ID</th>
                <th>Created At</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in users %}
            <tr>
                <td>{{ customer.id }}</td>
                <td>{{ customer.name }}</td>
                <td>{{ customer.user_id }}</td>
                <td>{{ customer.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="card mt-4">
        <div class="card-header bg-primary text-white">
            How This Attack Works
        </div>
        <div class="card-body">
            <p>The SQL injection attack used is <code>' OR 1=1 --</code>, which works as follows:</p>
            <ol>
                <li>The single quote (<code>'</code>) closes the name string in the query</li>
                <li>The <code>OR 1=1</code> makes the WHERE clause always true</li>
                <li>The double dash (<code>--</code>) comments out the rest of the query</li>
            </ol>
            <p>This transforms the original query from:</p>
            <pre><code>SELECT * FROM customers WHERE name = '' OR 1=1 --'</code></pre>
            <p>Into effectively:</p>
            <pre><code>SELECT * FROM customers WHERE name = '' OR 1=1</code></pre>
            <p>Since <code>1=1</code> is always true, this returns all customers!</p>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header bg-success text-white">
            How to Prevent SQL Injection
        </div>
        <div class="card-body">
            <h5>Use Parameterized Queries</h5>
            <pre><code>cursor.execute('SELECT * FROM customers WHERE name = ?', (customer_name,))</code></pre>
            
            <h5>Use an ORM (Object-Relational Mapping) Library</h5>
            <p>ORMs like SQLAlchemy handle parameter escaping automatically.</p>
            
            <h5>Input Validation</h5>
            <p>Validate and sanitize all user inputs before using them in SQL queries.</p>
        </div>
    </div>

    <div class="mt-4">
        <a href="{{ url_for('add_customer') }}" class="btn btn-primary">Try Again</a>
        <a href="{{ url_for('customers') }}" class="btn btn-secondary">View Your Customers</a>
        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Back to Home</a>
    </div>
</div>
{% endblock %} 